# @package _global_

defaults:
  - override /data: siamese_chair_large
  - override /model: siamese
  - override /callbacks: default
  - override /trainer: default
  # - override /logger: wandb

task_name: "train"
test: True

trainer:
  accelerator: cpu
  max_epochs: 10
  check_val_every_n_epoch: 1
  limit_train_batches: 1
  limit_val_batches: 1
  val_check_interval: 1
  log_every_n_steps: 1
  # profiler:
  #   _target_: lightning.pytorch.profilers.SimpleProfiler 
  #   dirpath: ${paths.output_dir}/profiler
  #   filename: simple_profiler
  

data:
  batch_size: 32
  num_workers: 7
  pin_memory: True
  drop_last: True
  persistent_workers: True
  shuffle: False
  sampler: null
  # sampler:
  #   _target_: pytorch_metric_learning.samplers.MPerClassSampler
  #   _partial_: True
  #   m: 4
  dataset:
    _target_: lib.data.siamese_dataset.SiameseDatasetEasyImages
  collate_fn:
    _target_: lib.data.siamese_datamodule.chunk_collate_fn
    _partial_: True

model:
  scheduler: null
  optimizer:
    lr: 5e-05
  decoder:
    _target_: lib.models.layers.ResNet18
    embedding_size: 128
  miner:
    _target_: pytorch_metric_learning.miners.TripletMarginMiner
    margin: 0.2
    type_of_triplets: semihard
  loss:
    _target_: pytorch_metric_learning.losses.TripletMarginLoss
    margin: 0.2
    swap: False
    smooth_loss: False
    triplets_per_anchor: all
    reducer: 
      _target_: pytorch_metric_learning.reducers.ThresholdReducer
      low: 0
    # distance: 
    #   _target_: pytorch_metric_learning.distances.CosineSimilarity

tags: ["siamese", "images"]

# logger:
#   wandb:
#     tags: ${tags}
#     group: "siamese"